!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Muuri"),require("_")):"function"==typeof define&&define.amd?define(["Muuri","_"],t):"object"==typeof exports?exports.Pele=t(require("Muuri"),require("_")):e.Pele=t(e.Muuri,e._)}(self,(function(e,t){return function(){"use strict";var n={532:function(t){t.exports=e},185:function(e){e.exports=t}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return n[e](r,r.exports,o),r.exports}o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:String(n)}function i(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}o.r(r),o.d(r,{MuuriSlideShow:function(){return h}}),o(185);var a=o(532),s=o.n(a);function l(e,t){var n=Element.prototype;return(n.matches||n.matchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector).call(e,t)}function c(e,t){if(window.Element&&!Element.prototype.closest){for(var n=l(e,t);!n&&e&&e!==document;)n=(e=e.parentNode)&&e!==document&&l(e,t);return e&&e!==document?e:null}return e.closest(t)}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}var d={pele_dragover:"pele_dragover",pele_edit_mode:"pele_edit-mode",pele_zoomedin:"pele_zoomedin",pele_chosen_one:"pele_chosen_one",pele_sleeping:"pele_sleeping",DRAGON_DROP_MIME_TYPE:"application/x-pele-move-slideshow"},h=function(){function t(e){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=0,r=document.documentElement;this.gridContainer=document.getElementById(e.ID);var a=this.gridElement;function l(){var e=this.grid.getElement().getAttribute("data-pele-square-size-column-count");this.ComputeFitColumns()!=e&&setTimeout(g.bind(this),50)}e=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){var o,r,a;o=e,r=t,a=i[t],(r=n(r))in o?Object.defineProperty(o,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[r]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({layoutDuration:400,layoutEasing:"ease",dragEnabled:!0,dragSortHeuristics:{sortInterval:50,minDragDistance:10,minBounceBackAngle:1},layout:{rounding:!1},dragStartPredicate:function(e,t){return!this.InDragCancelZone(e,t)&&s().ItemDrag.defaultStartPredicate(e,t)}.bind(this),dragPlaceholder:{enabled:!0,duration:400,createElement:function(e){return this.CreateDragShadow(e)}.bind(this)},dragReleaseDuration:400,dragReleaseEasing:"ease"},e),this.grid=new(s())(a,e).on("dragStart",(function(){++o,r.classList.add("dragging")})).on("dragEnd",(function(){--o<1&&r.classList.remove("dragging")})).on("move",(function(e){e.item.isDragging()&&i.ConsolidateMove(f(e.item.getElement()),e.fromIndex,e.toIndex,e.action),i.updateIndices()})).on("sort",(function(){return i.updateIndices()})).on("layoutEnd",l.bind(this)).on("add",l.bind(this)).on("remove",l.bind(this)),a.addEventListener("click",(function(e){i.OnClick(e)})),a.addEventListener("dblclick",(function(e){i.OnDblClick(e)})),a.addEventListener("dragover",(function(e){e.preventDefault()}),!1),a.addEventListener("drop",function(e){var t=e.dataTransfer.getData("text/html")||e.dataTransfer.getData("text/uri-list")||e.dataTransfer.getData("text");t&&(console.debug("text/drop",t),this.DoAdd(t),e.preventDefault(),e.stopPropagation())}.bind(this)),g.call(this),this.ShowHideBasedOnZoomin()}var o,r;return o=t,r=[{key:"gridElement",get:function(){return this.gridContainer.querySelector(".grid")}},{key:"ConsolidateMove",value:function(){this.Action.apply(this,["DoMove"].concat(Array.prototype.slice.call(arguments)))}},{key:"OnDblClick",value:function(e){var t=c(e.target,".item");t?this.grid.getItems(t)[0].isDragging()||this.SlideZoom():c(e.target,".pele_deactive_overlay")&&e.stopPropagation()}},{key:"OnClick",value:function(e){var t=c(e.target,".item");t&&this.InEditMode()||(t&&!this.IsInZoomMode()?this.DoSelect(f(t)):c(e.target,".pele_deactive_overlay"))}},{key:"DoAdd",value:function(){this.Action.apply(this,["DoAdd"].concat(Array.prototype.slice.call(arguments)))}},{key:"DoDelete",value:function(){this.Action.apply(this,["DoDelete"].concat(Array.prototype.slice.call(arguments)))}},{key:"DoSelect",value:function(){this.Action.apply(this,["DoSelect"].concat(Array.prototype.slice.call(arguments)))}},{key:"Action",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];switch(e){case"DoAdd":(function(e){this.AddUnknown(e)}).apply(this,n);break;case"DoDelete":(function(e,t){var n=this.ItemFromId(e)||this.findChosenItem();m.call(this,n,t)}).apply(this,n);break;case"DoMove":(function(e,t,n,i){if("move"===i){var o=this.ItemFromId(e);this.grid.move(o,n,!1)}}).apply(this,n);break;case"DoSelect":(function(e){var t=this.ItemFromId(e).getElement();p.call(this,t)}).apply(this,n);break;case"ToggleZoom":(function(e){var t=this.ItemFromId(e).getElement();b.call(this,t)}).apply(this,n);break;case"SetIframeActiveState":(function(e,t){var n=this.ItemFromId(e).getElement();y.call(this,n,t)}).apply(this,n)}}},{key:"ItemFromId",value:function(e){var t=this.grid.getElement().querySelector("[data-id='"+e+"']");return this.grid.getItems(t)[0]}},{key:"RemoveItem",value:function(e){this.DoDelete(f(c(e,".item")))}},{key:"CreateDragShadow",value:function(e){return e.getElement().cloneNode(!0)}},{key:"InDragCancelZone",value:function(e,t){return this.InEditMode()||this.IsInZoomMode()}},{key:"IsInZoomMode",value:function(){return document.body.classList.contains(d.pele_zoomedin)}},{key:"DoAddElement",value:function(e){I.call(this,e),this.grid.add(e),this.updateIndices(),this.ShowHideBasedOnZoomin(),this.IsInZoomMode()&&p.call(this,e)}},{key:"AddUnknown",value:function(t){try{this.AddType.apply(this,function(t){if(Array.isArray(t))return e(t)}(n=JSON.parse(t))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}catch(e){this.DoAddText(t)}var n}},{key:"ExportData",value:function(e){var t=e.querySelector(".card-content").firstElementChild._pele_export_data;return[["text/plain",JSON.stringify(t)]]}},{key:"SlidePrevious",value:function(){this.SlideIncrement(-1)}},{key:"SlideNext",value:function(){this.SlideIncrement(1)}},{key:"SlideZoom",value:function(){this.IsInZoomMode()||this.ToggleZoom()}},{key:"ToggleZoom",value:function(){var e=this.findChosenOne();e&&this.Action("ToggleZoom",f(e))}},{key:"SetIframeActiveState",value:function(e,t){e&&e.querySelector(".card-content iframe")&&this.Action("SetIframeActiveState",f(e),t)}},{key:"SlideUnzoom",value:function(){this.IsInZoomMode()&&this.ToggleZoom()}},{key:"SlideIncrement",value:function(e){var t=this.grid.getItems(0);if(t.length){var n,i=this.findChosenItem();if(i){var o=this.ElementIndex(i);(n=this.grid.getItems(o+e)).length||(n=this.grid.getItems(0))}else n=t;this.DoSelect(f(n[0].getElement()))}}},{key:"InEditMode",value:function(){return this.grid.getElement().classList.contains(d.pele_edit_mode)}},{key:"EnterEditMode",value:function(){this.grid.getElement().classList.add(d.pele_edit_mode),this.grid.getItems().forEach((function(e){e.getElement().querySelector(".card").setAttribute("draggable",!0)}))}},{key:"ExitEditMode",value:function(){this.grid.getElement().classList.remove(d.pele_edit_mode),this.grid.getItems().forEach((function(e){e.getElement().querySelector(".card").removeAttribute("draggable")}))}},{key:"ShowHideBasedOnZoomin",value:function(){var e=this.IsInZoomMode(),t=this.findChosenOne();if(e&&t){var n=this.grid.getItems().filter((function(e){return t!=e}));this.grid.hide(n),this.grid.show(t)}else this.grid.show(this.grid.getItems())}},{key:"ComputeFitColumns",value:function(){var e=this.grid.getItems().length;return function(e,t){var n=e.getBoundingClientRect(),i=Math.sqrt(t*n.height/n.width);if(i<1)return Math.ceil(t/(i*i));var o=Math.min(t,Math.ceil(i));return Math.ceil(Math.sqrt(t*n.width/n.height)),Math.min(t,Math.ceil(o*n.width/n.height))}(this.gridContainer,e)}},{key:"ElementIndex",value:function(e){return this.grid.getItems().indexOf(e)}},{key:"unchooseSlide",value:function(e){e&&e.classList.remove(d.pele_chosen_one)}},{key:"findChosenItem",value:function(){var e=this.grid.getItems().filter((function(e){return e.getElement().classList.contains(d.pele_chosen_one)}));if(e.length)return e[0]}},{key:"findChosenOne",value:function(){var e=this.findChosenItem();if(e)return e.getElement()}},{key:"chooseSlide",value:function(e){e&&e.classList.add(d.pele_chosen_one)}},{key:"DeleteSlide",value:function(e){(function(e){return e.classList.contains(d.pele_chosen_one)})(e)&&this.unchooseSlide(e),this.IsInZoomMode()&&v.call(this),this.ShowHideBasedOnZoomin()}},{key:"updateIndices",value:function(){this.grid.getItems().forEach((function(e,t){var n=t+1;e.getElement().querySelector(".card-id").innerHTML=n,e._dragPlaceholder.isActive()&&(e._dragPlaceholder._element.querySelector(".card-id").innerHTML=n)}))}}],r&&i(o.prototype,r),Object.defineProperty(o,"prototype",{writable:!1}),t}();function f(e){return e.getAttribute("data-id")}function m(e,t){function n(e){this.DeleteSlide(e.getElement()),this.grid.remove(e,{removeElements:!0}),this.updateIndices()}e&&(t.inplaybackmode?n.call(this,e):this.grid.hide(e,{onFinish:function(t){n.call(this,e)}.bind(this)}))}function g(){this.updateIndices(),this.grid.getElement().setAttribute("data-pele-square-size-column-count",this.ComputeFitColumns()),this.grid.refreshItems().layout()}function p(e){e&&(this.unchooseSlide(this.findChosenOne()),this.chooseSlide(e),this.ShowHideBasedOnZoomin())}function y(e,t){if(e){var n=e.querySelector(".card-content iframe");n&&(console.debug("iFrame detected",n,t),t?(e.classList.add(d.pele_sleeping),n.setAttribute("sandbox","")):(e.classList.remove(d.pele_sleeping),n.removeAttribute("sandbox")),n.src=n.src)}}function v(){document.body.classList.remove(d.pele_zoomedin)}function b(e){this.IsInZoomMode()?v.call(this):document.body.classList.add(d.pele_zoomedin),g.call(this),this.ShowHideBasedOnZoomin()}function I(e){var t=c(e,".item"),n=this;e.addEventListener("dragstart",(function(e){console.debug("dragstart",e.target),n.ExportData(t).forEach((function(t){e.dataTransfer.setData(t[0],t[1])})),e.stopPropagation()}),!0)}}(),r}()}));